# ImageManager
Stable Diffusion WebUI や reforge で生成された画像の **ファイルを移動・コピー** したり、 **プロンプトを確認** するためのアプリです。\
WebUI のデフォルト設定で作成される **日付ごとのフォルダをまとめて管理** できます。\
Python 3.10.6で動作確認

## 主な機能
- 選択したフォルダ内の画像ファイル **（サブフォルダ含む）** を表示
- メタデータの表示
- 空のサブフォルダを削除（ゴミ箱に移動）
- 画像ファイルの移動
- 連番を付けて画像ファイルをコピー
- **対応画像形式**：`png` / `jpg` / `webp` （アニメーションwebp簡易対応）  
![Image](https://github.com/user-attachments/assets/a5e1c112-0a1c-41d9-91fc-7b5d7708e9c9)
---
## インストール方法
1. ブランチ右上の **<>Code** をクリックし、 **Download ZIP** でダウンロード
2. 日本語など **マルチバイト文字を含まないフォルダ** に解凍
3. `ImageManagerRun.bat` を実行
4. **「WindowsによってPCが保護されました」** が表示された場合：
   - **詳細情報** をクリック → `実行` をクリック
5. 依存ファイルのインストール完了後、アプリが起動

### アンインストール方法
フォルダごと削除してください。

---
## 使い方
### 起動方法
2回目以降の起動も `ImageManagerRun.bat` を実行。

1. `フォルダ選択` をクリック、WebUIのtxt2imgフォルダ等、画像フォルダまたは親フォルダを選択して `フォルダの選択` をクリック
2. 空のサブフォルダがある場合、削除するかダイアログ表示（削除するとゴミ箱へ移動） [フォルダ操作](#設定)
3. サムネイルが一覧表示

### 画像ファイルの移動
![Image](https://github.com/user-attachments/assets/b817885f-0822-42b3-9e71-7ba337248f32)
1. サムネイルをクリックして選択
2. ファイル操作の `ファイルを移動` をクリック
3. 移動先のフォルダを選択し `フォルダの選択` をクリック  

### 画像ファイルのコピー
![Image](https://github.com/user-attachments/assets/fdbcb632-3ce2-4643-b6e2-0f11d8f802f9)
1. ファイル操作の `Copy Mode: OFF` をクリック（ボタンが `Copy Mode: ON` に変わる）
2. **コピーしたい順番に** サムネイルをクリック（番号表示）
3. ファイル操作の `ファイルをコピー` をクリック
4. コピー先フォルダを選択し `フォルダの選択` をクリック
   - `振られた番号3桁` + `_` + `元のファイル名` でコピー
   - 既に連番付きファイルがある場合、**続きの番号** から振り直される
5. `Copy Mode: ON` をクリックで **コピーモード終了**

### サブフォルダ検索：デフォルトON
![Image](https://github.com/user-attachments/assets/d0426e7e-31ae-4c02-aa83-0ac562b7e65b)  
- OFFにすると選択したフォルダ直下の画像のみ表示
- 次回フォルダ選択時から変更されます

## その他の機能
### サムネイル
- **マウスオーバー** でフォルダパス表示
- **ダブルクリック** で拡大・縮小可能なプレビュー表示 [画像表示ダイアログ](#設定)
  - アニメーションwebpは **V** アイコンが表示され、ダブルクリックで再生
- **右クリック** でメタデータ表示/フォルダを開く [サムネイル右クリック時の動作](#設定)
   - テキスト選択タブ  
   ![Image](https://github.com/user-attachments/assets/2770dad0-358f-4219-a435-c1b770ea3b01)
   - タグ選択  
     クリックでタグを選択して、`クリップボードにコピー` 可能  
   ![Image](https://github.com/user-attachments/assets/59931247-7963-4e11-9cf3-75faf202f3fb)  
   ネストされた（）等、タグの区切りが正しく認識されないことがあります

### ソート
- **ファイル名** 、 **更新日付** 、 **読み込み順** でソート [フォルダ選択時の初期ソート](#設定)

### フィルタ機能
![Image](https://github.com/user-attachments/assets/0afdc320-1038-4747-8356-d69b779211ba)
- **メタデータのPositive、Negative、Infoでフィルタリング**
  - テキストボックスに `,（カンマ）` 区切りで複数ワード入力可
  - 空白で `Filter` を押すとフィルタ解除
  - ラジオボタンで `AND検索`（すべてを含む）/ `OR検索`（いずれかを含む）を切り替え
  - 項目間はand固定（positive1 or positive2）and （negative1 or negative2）


### フォルダツリー
- クリックでフォルダ内のファイルを表示
- 同じフォルダ、サブフォルダでもファイル再読み込み
- 選択状態はクリア

---
## ツール
### ワイルドカード作成（Dynamic Prompts 用）
1. サムネイルをクリックして画像を選択
2. `ツール` -> `ワイルドカード作成(W)` をクリック
3. 別ウィンドウが開き、
   - 左側：選択したサムネイルの1枚目を表示
   - 右側：ポジティブプロンプトを **行ごとに表示**
![Image](https://github.com/user-attachments/assets/18373f5e-5744-4fe7-9446-36763511d6aa)
5. サムネイル下のナビゲーションボタンで画像を移動しながら、出力したい行のチェック、コメント追加が可能 [ワイルドカード作成コメント出力形式](#ワイルドカード作成コメント出力形式)
  - `選択行をプレビュー` または `全行をプレビュー` で出力プレビューを開く
  - `クリップボードへコピー` 可
6. ワイルドカード出力プレビュー
![Image](https://github.com/user-attachments/assets/d4b88a28-d4da-41ca-8c2c-82b9a0316b06)
  - 置換機能：検索する文字列、置換する文字列を入力し、`Replace` をクリックで一括置換
  - 各画像のコメント、プロンプトを編集可能
  - `ファイルへ出力` でtxtファイルで出力

### D&Dウィンドウ  
![Image](https://github.com/user-attachments/assets/697c55bf-67aa-45aa-a833-fe32cdd06abb)
- ディスプレイ右下最前面に小さなウィンドウを表示
- アプリ外のエクスプローラから画像ファイルをドラッグ＆ドロップするとメタデータを表示

---


## 設定
![Image](https://github.com/user-attachments/assets/45ddecb2-00ae-4ffa-8a22-538473bf3779)
### サムネイルサイズ
- 小さいほど読み込みが速くなります
- 変更すると再読み込みが発生するため、フォルダ選択前かファイルが少ないときの設定変更がおすすめです

### フォルダ選択時の初期ソート
- 前回選択したソート順を維持できますが、ソートは読み込み完了後に実行されます

### 画像表示ダイアログ
- **ダイアログサイズに合わせて表示** ：ウィンドウサイズに合わせて拡大縮小  
- **原寸で表示** ：Ctrl+スクロールで拡大縮小、ドラッグで移動（アニメーションwebpは拡縮できません）

### サムネイル右クリック時の動作
- 右クリックにファイルの場所を開くメニューを表示

### フォルダ操作
- 空フォルダ削除のON/OFF

### ワイルドカード作成コメント出力形式
- **コメントを別行で出力（＃コメント）** ：**webUIでは表示されない。** プロンプトとは別の行にコメントを出力（プロンプトの上）。
  - txtファイル\
![Image](https://github.com/user-attachments/assets/29aa43d9-4f04-47c6-b092-748eeb8dd2b5)
  - webUI\
![Image](https://github.com/user-attachments/assets/52713fad-7469-44de-8f75-1c8e7c862cc6)
- **コメントを角括弧で出力（[コメント:100]）** ：**webUIで表示される。** スケジュール構文を利用したもので、生成時`Sampling stepsが100未満`であれば影響をうけない。はず。
  - txtファイル\
![Image](https://github.com/user-attachments/assets/96f733d8-73d1-40f8-80b2-a0c51b94bb26)
  - webUI\
![Image](https://github.com/user-attachments/assets/fa83fd84-d6f9-4f3d-9aec-5181fe3274e7)


---
